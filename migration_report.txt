
FASE 1: BUSCA DE OCORRENCIAS

================================================================================
BUSCANDO TODAS AS OCORRÊNCIAS DE 'skills/cm'
================================================================================

Arquivos escaneados: 1639
Arquivos com ocorrências: 44

================================================================================
OCORRÊNCIAS ENCONTRADAS
================================================================================


[FILE] .github\copilot-instructions.md (6 ocorrencias)
   Linha   11: - **Dual Storage**: Services stored in both Consul's service registry AND KV store under `skills/cm/
   Linha   22: skills/cm/blackbox/targets/<id>.json     # Blackbox monitoring targets
   Linha   23: skills/cm/blackbox/groups/<id>.json      # Logical groupings
   Linha   24: skills/cm/services/presets/<id>.json     # Service templates
   Linha   25: skills/cm/audit/YYYY/MM/DD/<ts>.json     # Audit trail
   Linha  132: - **Namespace Isolation**: All KV operations must use `skills/cm/` prefix

[FILE] ANALISE_ARQUITETURA_FINAL.md (7 ocorrencias)
   Linha   21: Executado script `analyze_kv_usage.py` para listar TODAS as keys em `skills/cm/`.
   Linha   88: fields_data = await kv.get_json('skills/cm/metadata/fields')
   Linha  198: - `skills/cm/metadata/`: Campos din?micos (melhoria sobre TenSunS)
   Linha  199: - `skills/cm/services/presets/`: Templates reutiliz?veis
   Linha  200: - `skills/cm/audit/`: Logs de opera??es
   Linha  201: - `skills/cm/reference-values/`: Autocomplete values
   Linha  202: - `skills/cm/settings/`: Configura??es de UI

[FILE] CLAUDE.md (5 ocorrencias)
   Linha   32: - **Consul KV**: Metadata, groups, presets, audit logs under `skills/cm/` namespace
   Linha   62: skills/cm/
   Linha  127: - **Credential Storage**: Encrypted storage in Consul KV under `skills/cm/settings/credentials`
   Linha  401: - **Test KV writes** under `skills/cm/test/` first
   Linha  403: - **Backup KV data** before bulk operations: `GET /api/v1/kv/tree?prefix=skills/cm`

[FILE] PLANO_MIGRACAO_TENSUNS.md (33 ocorrencias)
   Linha  100: SkillsEye: **MELHORIA** - Din?mico via `skills/cm/metadata/fields` no KV
   Linha  135: all_keys = await kv.get_keys('skills/cm')
   Linha  144: parts = key.replace('skills/cm/', '').split('/')
   Linha  177: print(f"    KV (skills/cm/blackbox/targets): {blackbox_targets_kv} targets")
   Linha  199: print("  ? CR?TICO: Eliminar skills/cm/blackbox/targets/")
   Linha  221: Busca TODOS os arquivos que acessam skills/cm/blackbox/targets
   Linha  230: print("BUSCA DE C?DIGO USANDO skills/cm/blackbox/targets")
   Linha  327: **DECIS?O**: Eliminar completamente `skills/cm/blackbox/targets/*` do KV
   Linha  355: | **Metadata Fields Din?micos** | `skills/cm/metadata/fields` (KV) | ? Permite configurar campos via
   Linha  357: | **Service Presets** | `skills/cm/services/presets` (KV) | ? Templates reutiliz?veis, melhoria sobr
   ... e mais 23 linhas

[FILE] README.md (1 ocorrencias)
   Linha  223: - **Namespace isolado:** `skills/cm/`

[FILE] backend\analyze_audit_retention.py (1 ocorrencias)
   Linha   30: audit_prefix = "skills/cm/audit"

[FILE] backend\analyze_kv_usage.py (4 ocorrencias)
   Linha   24: all_keys = await kv.list_keys('skills/cm')
   Linha   33: parts = key.replace('skills/cm/', '').split('/')
   Linha   50: print(f"    KV (skills/cm/blackbox/targets): {blackbox_targets_kv} targets")
   Linha   72: print("  [CRITICO] Eliminar skills/cm/blackbox/targets/")

[FILE] backend\api\kv.py (6 ocorrencias)
   Linha    6: - Escrita (/value POST, DELETE): Restrito a 'skills/cm/' por seguran?a
   Linha   19: PRIMARY_PREFIX = "skills/cm/"
   Linha   23: "skills/cm/",
   Linha   50: Apenas permite modifica??es em 'skills/cm/' por seguran?a.
   Linha   97: RESTRITO a 'skills/cm/' por seguran?a.
   Linha  112: RESTRITO a 'skills/cm/' por seguran?a.

[FILE] backend\api\metadata_fields_manager.py (6 ocorrencias)
   Linha  180: fields_data = await kv.get_json('skills/cm/metadata/fields')
   Linha  189: fields_data = await kv.get_json('skills/cm/metadata/fields')
   Linha  229: key='skills/cm/metadata/fields',
   Linha  266: Campos s?o salvos no KV: skills/cm/metadata/fields
   Linha  275: success = await kv.put_json('skills/cm/metadata/fields', config)
   Linha  280: logger.info(f"Configura??o salva no KV: skills/cm/metadata/fields")

[FILE] backend\api\models.py (1 ocorrencias)
   Linha  188: key: str = Field(..., description="Chave completa (prefixo skills/cm/)")

[FILE] backend\api\prometheus_config.py (3 ocorrencias)
   Linha  254: kv_data = await kv_manager.get_json('skills/cm/metadata/fields')
   Linha  311: # Salvar no KV: skills/cm/metadata/fields
   Linha  313: key='skills/cm/metadata/fields',

[FILE] backend\api\settings.py (2 ocorrencias)
   Linha   22: SETTINGS_KV_PATH = "skills/cm/settings/"
   Linha  285: # Settings deve ler do Consul KV (skills/cm/metadata/fields.json)

[FILE] backend\app.py (2 ocorrencias)
   Linha   68: 3. Salva automaticamente no Consul KV (skills/cm/metadata/fields)
   Linha  121: key='skills/cm/metadata/fields',

[FILE] backend\check_kv.py (2 ocorrencias)
   Linha   10: url = f"http://{CONSUL_HOST}:{CONSUL_PORT}/v1/kv/skills/cm/metadata/fields"
   Linha   55: print("[NOT FOUND] Chave 'skills/cm/metadata/fields' n?o existe no Consul KV!")

[FILE] backend\cleanup_duplicate_audit_logs.py (3 ocorrencias)
   Linha   27: 1. Lista todos os audit logs (skills/cm/audit/*)
   Linha   38: audit_prefix = "skills/cm/audit"
   Linha  166: audit_prefix = "skills/cm/audit"

[FILE] backend\core\config.py (3 ocorrencias)
   Linha   60: NOTA: Agora busca do Consul KV (skills/cm/metadata/fields)
   Linha   69: fields_data = asyncio.run(kv.get_json('skills/cm/metadata/fields'))
   Linha   92: fields_data = asyncio.run(kv.get_json('skills/cm/metadata/fields'))

[FILE] backend\core\kv_manager.py (9 ocorrencias)
   Linha   19: All app data is stored under 'skills/cm/' prefix to avoid conflicts.
   Linha   23: PREFIX = "skills/cm"
   Linha   57: key: Full key path (must start with skills/cm/)
   Linha   82: key: Full key path (must start with skills/cm/)
   Linha  113: key: Full key path (must start with skills/cm/)
   Linha  126: prefix: Prefix path (must start with skills/cm/)
   Linha  144: prefix: Prefix path (must start with skills/cm/)
   Linha  157: prefix: Prefix path (must start with skills/cm/)
   Linha  471: # Example: ConsulManager/record/blackbox/module_list -> skills/cm/blackbox/modules.json

[FILE] backend\core\monitoring_type_manager.py (1 ocorrencias)
   Linha   26: 2. Consul KV-based (futuro): L? de skills/cm/monitoring-types/

[FILE] backend\core\reference_values_manager.py (3 ocorrencias)
   Linha   10: 2. Sistema automaticamente cria registro em skills/cm/reference-values/company/ramada.json
   Linha  390: Chave completa: skills/cm/reference-values/{field_name}/{value_slug}.json
   Linha  393: ("company", "Empresa Ramada") ? "skills/cm/reference-values/company/empresa_ramada.json"

[FILE] backend\delete_reference_value_logs.py (2 ocorrencias)
   Linha   20: logs = await cm.get_kv_tree('skills/cm/audit')
   Linha   54: logs_after = await cm.get_kv_tree('skills/cm/audit')

[FILE] backend\docs\CLEANUP_STRATEGY.md (2 ocorrencias)
   Linha  144: - skills/cm/blackbox/groups/{group_id}.json (mantido - metadados apenas)
   Linha  162: - [x] Confirmado: 0 targets no KV `skills/cm/blackbox/targets`

[FILE] backend\docs\KV_USAGE_ANALYSIS.txt (1 ocorrencias)
   Linha   19: KV (skills/cm/blackbox/targets): 0 targets

[FILE] backend\docs\dual_storage_code_locations.json (5 ocorrencias)
   Linha    9: "code": "print(f\"    KV (skills/cm/blackbox/targets): {blackbox_targets_kv} targets\")",
   Linha   15: "code": "print(\"  [CRITICO] Eliminar skills/cm/blackbox/targets/\")",
   Linha   27: "code": "print(f\"    KV (skills/cm/blackbox/targets): {blackbox_targets_kv} targets\")",
   Linha   53: "code": "Busca TODOS os arquivos que acessam skills/cm/blackbox/targets",
   Linha   59: "code": "print(\"BUSCA DE CODIGO USANDO skills/cm/blackbox/targets\")",

[FILE] backend\find_dual_storage_code.py (2 ocorrencias)
   Linha    2: Busca TODOS os arquivos que acessam skills/cm/blackbox/targets
   Linha   11: print("BUSCA DE CODIGO USANDO skills/cm/blackbox/targets")

[FILE] backend\populate_external_labels.py (2 ocorrencias)
   Linha   52: sites_data = await kv.get_json("skills/cm/settings/sites")
   Linha   82: success = await kv.put_json("skills/cm/settings/sites", {"sites": sites})

[FILE] backend\test_audit_fix.py (2 ocorrencias)
   Linha   40: audit_logs_before = await consul.get_kv_tree("skills/cm/audit")
   Linha   76: audit_logs_after = await consul.get_kv_tree("skills/cm/audit")

[FILE] backend\test_phase1.py (6 ocorrencias)
   Linha   22: test_key = "skills/cm/test/sample.json"
   Linha   33: keys = await kv.list_keys("skills/cm/test/")
   Linha   34: print(f"  Found {len(keys)} keys under skills/cm/test/")
   Linha  169: await kv.put_json("skills/cm/test/valid.json", {"test": "valid"})
   Linha  229: await kv.delete_key("skills/cm/test/sample.json")
   Linha  230: await kv.delete_key("skills/cm/test/valid.json")

[FILE] docs\api\endpoints-reference.md (1 ocorrencias)
   Linha   92: **Credenciais:** Configuradas no Consul KV: `skills/cm/settings/credentials`

[FILE] docs\guides\migration.md (6 ocorrencias)
   Linha   11: 1. **Standardized KV Namespace**: All app data moved to `skills/cm/*`
   Linha  186: curl "http://localhost:5000/api/v1/kv/list?prefix=skills/cm/blackbox/targets/"
   Linha  285: KV_NAMESPACE=skills/cm        # Default namespace
   Linha  356: curl "http://localhost:5000/api/v1/kv/tree?prefix=skills/cm/" > kv_backup.json
   Linha  397: **Problem:** Trying to access KV keys outside `skills/cm/`
   Linha  399: **Solution:** All app KV keys must start with `skills/cm/`. Use the API endpoints which enforce this

[FILE] docs\guides\quick-start.md (1 ocorrencias)
   Linha  159: - Chave: `skills/cm/test/my-key`

[FILE] docs\guides\reference-values.md (1 ocorrencias)
   Linha   56: skills/cm/reference-values/

[FILE] docs\history\phase1-implementation.md (10 ocorrencias)
   Linha   16: skills/cm/
   Linha   37: - **Namespace Safety**: All operations validate keys start with `skills/cm/`
   Linha  202: GET    /api/v1/kv/get?key=skills/cm/...          # Get single key
   Linha  204: DELETE /api/v1/kv/delete?key=skills/cm/...      # Delete key
   Linha  205: GET    /api/v1/kv/list?prefix=skills/cm/...     # List keys
   Linha  206: GET    /api/v1/kv/tree?prefix=skills/cm/...     # Get tree
   Linha  512: "key": "skills/cm/test/hello.json",
   Linha  517: curl "http://localhost:5000/api/v1/kv/get?key=skills/cm/test/hello.json"
   Linha  613: ### Why skills/cm/ Namespace?
   Linha  665: 1. **Namespace Validation**: All KV operations validate `skills/cm/` prefix

[FILE] docs\history\phase3-implementation.md (2 ocorrencias)
   Linha   75: - Valida??o de namespace (`skills/cm/*`)
   Linha  309: 2. Digite caminho completo come?ando com `skills/cm/`

[FILE] docs\performance\ANALISE_COMPLETA_PROBLEMAS_PERFORMANCE.md (12 ocorrencias)
   Linha   87: ?         ?  skills/cm/metadata/fields    ?                      ?
   Linha  156: - **KV Store**: Consul KV (namespace: skills/cm/)
   Linha  215: kv_data = await kv_manager.get_json('skills/cm/metadata/fields')
   Linha  237: key='skills/cm/metadata/fields',
   Linha  259: ?       ??? GET /v1/kv/skills/cm/metadata/fields
   Linha  515: skills/cm/metadata/fields = {
   Linha  696: $ curl http://localhost:5000/api/v1/kv/value?key=skills/cm/metadata/fields
   Linha  845: kv_data = await kv_manager.get_json('skills/cm/metadata/fields')
   Linha 1174: key='skills/cm/metadata/fields',
   Linha 1289: key='skills/cm/metadata/fields',
   ... e mais 2 linhas

[FILE] docs\performance\RELATORIO_REAL_PERFORMANCE.md (4 ocorrencias)
   Linha  183: kv_data = await kv_manager.get_json('skills/cm/metadata/fields')
   Linha  205: key='skills/cm/metadata/fields',
   Linha  369: await kv_manager.put_json('skills/cm/metadata/fields', {...})
   Linha  485: ? skills/cm/metadata/ ?

[FILE] docs\performance\analysis-complete.md (12 ocorrencias)
   Linha  193: ?         ?  skills/cm/metadata/fields    ?                      ?
   Linha  262: - **KV Store**: Consul KV (namespace: skills/cm/)
   Linha  321: kv_data = await kv_manager.get_json('skills/cm/metadata/fields')
   Linha  343: key='skills/cm/metadata/fields',
   Linha  365: ?       ??? GET /v1/kv/skills/cm/metadata/fields
   Linha  621: skills/cm/metadata/fields = {
   Linha  802: $ curl http://localhost:5000/api/v1/kv/value?key=skills/cm/metadata/fields
   Linha  951: kv_data = await kv_manager.get_json('skills/cm/metadata/fields')
   Linha 1293: key='skills/cm/metadata/fields',
   Linha 1408: key='skills/cm/metadata/fields',
   ... e mais 2 linhas

[FILE] docs\planning\refactoring-architecture.md (4 ocorrencias)
   Linha  236: skills/cm/
   Linha  475: self.kv_prefix = "skills/cm/monitoring-types/"
   Linha  901: return f"skills/cm/tenants/{self.tenant_id}/{base_path}"
   Linha  915: // skills/cm/tenants/{tenant_id}/features.json

[FILE] docs\planning\refactoring-plan.md (11 ocorrencias)
   Linha   79: - [ ] `skills/cm/monitoring-types/network-probes.json`
   Linha   85: - [ ] `skills/cm/monitoring-types/web-probes.json`
   Linha   92: - [ ] `skills/cm/monitoring-types/system-exporters.json`
   Linha   97: - [ ] `skills/cm/monitoring-types/database-exporters.json`
   Linha  107: http://localhost:8500/v1/kv/skills/cm/monitoring-types/?keys
   Linha  110: # ["skills/cm/monitoring-types/network-probes.json", ...]
   Linha 1249: types_keys = await consul.kv_get_keys("skills/cm/monitoring-types/")
   Linha 1256: fields = await consul.kv_get("skills/cm/field-schemas/metadata-fields.json")
   Linha 1260: ui_config = await consul.kv_get("skills/cm/ui-configs/page-layouts.json")
   Linha 1453: skills/cm/monitoring-types/web-probes.json
   ... e mais 1 linhas

[FILE] frontend\src\pages\KvBrowser.tsx (6 ocorrencias)
   Linha   51: const DEFAULT_PREFIX = 'skills/cm/';
   Linha   53: { label: 'Skills CM (padr?o)', value: 'skills/cm/' },
   Linha   83: * Agora aceita QUALQUER prefixo, n?o apenas skills/cm/
   Linha  343: // IMPORTANTE: Edi??o/remo??o permitida APENAS em skills/cm/
   Linha  344: const isEditable = record.key.startsWith('skills/cm/');
   Linha  632: placeholder="Ex: skills/cm/config/settings"

[FILE] frontend\src\pages\PrometheusConfig.tsx (1 ocorrencias)
   Linha  571: params: { key: 'skills/cm/metadata/fields' }

[FILE] migrate_namespace.py (8 ocorrencias)
   Linha    2: Script de migra??o do namespace Consul KV de skills/cm/ para skills/eye/
   Linha   19: """Busca todas as ocorr?ncias de 'skills/cm' nos arquivos."""
   Linha   24: print("BUSCANDO TODAS AS OCORR?NCIAS DE 'skills/cm'")
   Linha   46: if 'skills/cm' in line:
   Linha   85: """Substitui 'skills/cm' por 'skills/eye' em todos os arquivos."""
   Linha  105: count = content.count('skills/cm')
   Linha  108: new_content = content.replace('skills/cm', 'skills/eye')
   Linha  133: print("[OK] Nenhuma ocorrencia de 'skills/cm' encontrada!")

[FILE] obsolete\README_PHASE1.md (3 ocorrencias)
   Linha   54: ?  ?  (Discovery) ?  consul_sd   ?  skills/cm/*  ?            ?
   Linha  114: KV_NAMESPACE=skills/cm
   Linha  293: skills/cm/

[FILE] obsolete\REFACTORING_TECHNICAL_DETAILS.md (1 ocorrencias)
   Linha  165: { service_id: 'skills/cm/blackbox/targets/1', kv_key: 'skills/cm/blackbox/targets/1' }

[FILE] obsolete\RESUMO_IMPLEMENTACAO_FINAL.md (1 ocorrencias)
   Linha  127: - External labels s?o armazenados em `skills/cm/settings/sites` no Consul KV

TOTAL: 204 linhas em 44 arquivos


FASE 2: DRY-RUN (Simulacao)

================================================================================
MODO DRY-RUN: Simulando substituições
================================================================================

[DRY-RUN] .github\copilot-instructions.md: 6 substituições
[DRY-RUN] ANALISE_ARQUITETURA_FINAL.md: 7 substituições
[DRY-RUN] CLAUDE.md: 5 substituições
[DRY-RUN] PLANO_MIGRACAO_TENSUNS.md: 33 substituições
[DRY-RUN] README.md: 1 substituições
[DRY-RUN] backend\analyze_audit_retention.py: 1 substituições
[DRY-RUN] backend\analyze_kv_usage.py: 4 substituições
[DRY-RUN] backend\api\kv.py: 6 substituições
[DRY-RUN] backend\api\metadata_fields_manager.py: 6 substituições
[DRY-RUN] backend\api\models.py: 1 substituições
[DRY-RUN] backend\api\prometheus_config.py: 3 substituições
[DRY-RUN] backend\api\settings.py: 2 substituições
[DRY-RUN] backend\app.py: 2 substituições
[DRY-RUN] backend\check_kv.py: 2 substituições
[DRY-RUN] backend\cleanup_duplicate_audit_logs.py: 3 substituições
[DRY-RUN] backend\core\config.py: 3 substituições
[DRY-RUN] backend\core\kv_manager.py: 9 substituições
[DRY-RUN] backend\core\monitoring_type_manager.py: 1 substituições
[DRY-RUN] backend\core\reference_values_manager.py: 3 substituições
[DRY-RUN] backend\delete_reference_value_logs.py: 2 substituições
[DRY-RUN] backend\docs\CLEANUP_STRATEGY.md: 2 substituições
[DRY-RUN] backend\docs\KV_USAGE_ANALYSIS.txt: 1 substituições
[DRY-RUN] backend\docs\dual_storage_code_locations.json: 5 substituições
[DRY-RUN] backend\find_dual_storage_code.py: 2 substituições
[DRY-RUN] backend\populate_external_labels.py: 2 substituições
[DRY-RUN] backend\test_audit_fix.py: 2 substituições
[DRY-RUN] backend\test_phase1.py: 6 substituições
[DRY-RUN] docs\api\endpoints-reference.md: 1 substituições
[DRY-RUN] docs\guides\migration.md: 6 substituições
[DRY-RUN] docs\guides\quick-start.md: 1 substituições
[DRY-RUN] docs\guides\reference-values.md: 1 substituições
[DRY-RUN] docs\history\phase1-implementation.md: 10 substituições
[DRY-RUN] docs\history\phase3-implementation.md: 2 substituições
[DRY-RUN] docs\performance\ANALISE_COMPLETA_PROBLEMAS_PERFORMANCE.md: 12 substituições
[DRY-RUN] docs\performance\RELATORIO_REAL_PERFORMANCE.md: 4 substituições
[DRY-RUN] docs\performance\analysis-complete.md: 12 substituições
[DRY-RUN] docs\planning\refactoring-architecture.md: 4 substituições
[DRY-RUN] docs\planning\refactoring-plan.md: 11 substituições
[DRY-RUN] frontend\src\pages\KvBrowser.tsx: 6 substituições
[DRY-RUN] frontend\src\pages\PrometheusConfig.tsx: 1 substituições
[DRY-RUN] migrate_namespace.py: 8 substituições
[DRY-RUN] obsolete\README_PHASE1.md: 3 substituições
[DRY-RUN] obsolete\REFACTORING_TECHNICAL_DETAILS.md: 2 substituições
[DRY-RUN] obsolete\RESUMO_IMPLEMENTACAO_FINAL.md: 1 substituições

Arquivos modificados: 44
Total de substituições: 205


[AVISO] FASE 3: APLICACAO REAL
Para aplicar as mudancas, execute:
  python migrate_namespace.py --apply

